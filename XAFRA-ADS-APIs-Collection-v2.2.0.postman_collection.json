{
	"info": {
		"_postman_id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
		"name": "XAFRA-ADS APIs Collection v2.2.0",
		"description": "Collection completa de APIs para XAFRA-ADS Motor de Publicidad\n\nüåê **Dominio:** apis.xafra-ads.com\nüìä **Capacidad:** 10,000+ visitas diarias\nüîí **Base de Datos:** PostgreSQL en GCP\n\n**üÜï NUEVA FUNCIONALIDAD v2.2.0 - TRACKING AUTOM√ÅTICO:**\n\n**Endpoint Principal:** `/ads/tr/{param}/`\n- ü§ñ **XAFRA-ADS genera tracking IDs √∫nicos autom√°ticamente**\n- üìù **Formato estandarizado:** XAFRA_YYYYMMDD_HHMMSS_NNNNN\n- üéØ **Ideal para partners sin sistema de tracking propio**\n- üîí **Control total del ciclo de tracking por XAFRA-ADS**\n- ‚ö° **Sin par√°metros obligatorios en la URL**\n- üîÑ **Completamente compatible con endpoints existentes**\n\n**Beneficios Clave:**\n‚úÖ **Simplicidad:** URLs m√°s simples sin par√°metros de tracking\n‚úÖ **Confiabilidad:** IDs √∫nicos garantizados por el sistema\n‚úÖ **Control:** XAFRA-ADS maneja completamente el tracking\n‚úÖ **Flexibilidad:** Mismos productos, diferentes modalidades\n‚úÖ **Escalabilidad:** Formato temporal permite ordenamiento\n‚úÖ **Compatibilidad:** Funciona con toda la infraestructura existente\n\n**Comparaci√≥n de Modalidades:**\n\n| **Modalidad** | **Control** | **URL Ejemplo** | **Uso Recomendado** |\n|--------------|-------------|-----------------|--------------------|\n| **Tracking Externo** | Partner/Traffic Source | `/ads/{param}/?clickId=EXT_123` | Partners con tracking propio |\n| **üÜï Tracking Autom√°tico** | XAFRA-ADS | `/ads/tr/{param}/` | Partners sin tracking propio |\n| **Tracking Corto CR** | Customer/XAFRA-ADS | `/api/config/xafra` + SMS | Confirmaciones SMS Costa Rica |\n\n**Endpoints principales:**\n- üÜï **Tracking Autom√°tico** (XAFRA-ADS genera IDs)\n- Procesamiento de Ads (tracking externo)\n- Auto-suscripci√≥n masiva\n- Testing y monitoreo\n- Utilidades y compras\n- Tracking corto Costa Rica\n\n**Fecha:** Septiembre 8, 2025\n**Versi√≥n:** v2.2.0-auto-tracking\n**√öltima actualizaci√≥n:** Implementaci√≥n de tracking autom√°tico\n**Commit:** cb46307 - AUTO-TRACKING: Implementaci√≥n completa de funcionalidad de tracking autom√°tico",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "12345678"
	},
	"item": [
		{
			"name": "üöÄ Health Checks",
			"item": [
				{
					"name": "Spring Boot Health Check",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/actuator/health",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"actuator",
								"health"
							]
						},
						"description": "Health check de Spring Boot Actuator - Endpoint principal para verificar el estado de la aplicaci√≥n"
					},
					"response": []
				},
				{
					"name": "Database Health Check",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/v1/db/health",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"v1",
								"db",
								"health"
							]
						},
						"description": "Health check completo de la base de datos PostgreSQL"
					},
					"response": []
				},
				{
					"name": "Simple Ping",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/v1/ping",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"v1",
								"ping"
							]
						},
						"description": "Health check simple que responde 'pong'"
					},
					"response": []
				}
			],
			"description": "Endpoints para verificar el estado de la aplicaci√≥n y base de datos"
		},
		{
			"name": "üÜï Tracking Autom√°tico (v2.2.0)",
			"item": [
				{
					"name": "ü§ñ Auto-Tracking - Product ID 110 (Digital-X CR)",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"console.log('ü§ñ Iniciando tracking autom√°tico v2.2.0...');",
									"console.log('üÜî Product ID: 110 (Digital-X Costa Rica - Kolbi)');",
									"console.log('üìä Endpoint: GET /ads/tr/{encrypted_param}/');",
									"console.log('üéØ Funcionalidad: XAFRA-ADS genera tracking ID autom√°ticamente');",
									"console.log('üìù Formato esperado: XAFRA_YYYYMMDD_HHMMSS_NNNNN');",
									"console.log('‚è∞ Timestamp test:', new Date().toISOString());"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('‚úÖ Status code is 302 (Redirect)', function () {",
									"    pm.expect(pm.response.code).to.eql(302);",
									"});",
									"",
									"pm.test('‚úÖ Response has Location header', function () {",
									"    pm.expect(pm.response.headers.has('location')).to.be.true;",
									"});",
									"",
									"pm.test('‚ö° Response time is acceptable', function () {",
									"    pm.expect(pm.response.responseTime).to.be.below(3000);",
									"});",
									"",
									"if (pm.response.code === 302) {",
									"    let locationHeader = pm.response.headers.get('location');",
									"    console.log('‚úÖ Redirecci√≥n exitosa a:', locationHeader);",
									"    ",
									"    // Extraer tracking ID de la URL de redirecci√≥n",
									"    let trackingMatch = locationHeader.match(/tracking=([^&]+)/);",
									"    if (trackingMatch) {",
									"        let autoTracking = trackingMatch[1];",
									"        console.log('ü§ñ Tracking auto-generado:', autoTracking);",
									"        pm.globals.set('auto_generated_tracking_110', autoTracking);",
									"        ",
									"        // Verificar formato XAFRA_YYYYMMDD_HHMMSS_NNNNN",
									"        let formatRegex = /^XAFRA_\\d{8}_\\d{6}_\\d{5}$/;",
									"        if (formatRegex.test(autoTracking)) {",
									"            console.log('‚úÖ Formato de tracking CORRECTO');",
									"            pm.test('‚úÖ Tracking format is correct', function () {",
									"                pm.expect(autoTracking).to.match(formatRegex);",
									"            });",
									"        } else {",
									"            console.log('‚ùå Formato de tracking INCORRECTO:', autoTracking);",
									"            pm.test('‚ùå Tracking format is incorrect', function () {",
									"                pm.expect(false).to.be.true; // Force fail",
									"            });",
									"        }",
									"        ",
									"        // Extraer componentes del tracking",
									"        let parts = autoTracking.split('_');",
									"        if (parts.length === 4) {",
									"            console.log('üìÖ Fecha:', parts[1]);",
									"            console.log('üïê Hora:', parts[2]);",
									"            console.log('üî¢ Secuencia:', parts[3]);",
									"        }",
									"    } else {",
									"        console.log('‚ö†Ô∏è No se encontr√≥ tracking en la URL de redirecci√≥n');",
									"        pm.test('‚ùå Tracking not found in redirect URL', function () {",
									"            pm.expect(false).to.be.true; // Force fail",
									"        });",
									"    }",
									"    ",
									"    // Verificar que redirige a Digital-X",
									"    if (locationHeader.includes('digital-x.com.co')) {",
									"        console.log('‚úÖ Redirecci√≥n correcta a Digital-X');",
									"        pm.test('‚úÖ Redirects to Digital-X domain', function () {",
									"            pm.expect(locationHeader).to.include('digital-x.com.co');",
									"        });",
									"    }",
									"    ",
									"    // Verificar pa√≠s Costa Rica",
									"    if (locationHeader.includes('costarica')) {",
									"        console.log('‚úÖ Pa√≠s correcto: Costa Rica');",
									"        pm.test('‚úÖ Country is Costa Rica', function () {",
									"            pm.expect(locationHeader).to.include('costarica');",
									"        });",
									"    }",
									"    ",
									"    // Verificar operador Kolbi",
									"    if (locationHeader.includes('kolbi')) {",
									"        console.log('‚úÖ Operador correcto: Kolbi');",
									"        pm.test('‚úÖ Operator is Kolbi', function () {",
									"            pm.expect(locationHeader).to.include('kolbi');",
									"        });",
									"    }",
									"} else {",
									"    console.log('‚ùå Error: Se esperaba redirecci√≥n 302, obtenido:', pm.response.code);",
									"    console.log('üìã Response body:', pm.response.text());",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/ads/tr/{{product_110_param}}/",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"ads",
								"tr",
								"{{product_110_param}}",
								""
							]
						},
						"description": "**üÜïü§ñ Endpoint de Tracking Autom√°tico v2.2.0**\n\n**Funcionalidad Principal:**\n- XAFRA-ADS genera autom√°ticamente un tracking ID √∫nico\n- No requiere par√°metros de tracking en la URL\n- El sistema controla completamente la generaci√≥n de IDs\n- Ideal para partners que no manejan tracking propio\n\n**Product ID 110: Digital-X Costa Rica - Kolbi**\n- Partner: Digital-X\n- Pa√≠s: Costa Rica (CR)\n- Operador: Kolbi\n- Par√°metro encriptado: `zhv130RYZdznrnewOUF$lA`\n\n**Algoritmo de Generaci√≥n:**\n```java\nprivate String generateAutoTracking() {\n    LocalDateTime now = LocalDateTime.now();\n    DateTimeFormatter formatter = DateTimeFormatter.ofPattern(\"yyyyMMdd_HHmmss\");\n    String timestamp = now.format(formatter);\n    String randomSuffix = String.valueOf(System.nanoTime() % 100000);\n    return \"XAFRA_\" + timestamp + \"_\" + randomSuffix;\n}\n```\n\n**Formato de Tracking Generado:**\n```\nXAFRA_YYYYMMDD_HHMMSS_NNNNN\nEjemplo: XAFRA_20250908_223015_42851\n\nComponentes:\n- XAFRA: Prefijo identificador\n- YYYYMMDD: Fecha (20250908)\n- HHMMSS: Hora (223015)\n- NNNNN: Secuencia √∫nica (42851)\n```\n\n**Flujo de Procesamiento:**\n1. Usuario accede a `/ads/tr/{encrypted_param}/`\n2. Sistema desencripta par√°metro ‚Üí Product ID 110\n3. Sistema genera tracking √∫nico: `XAFRA_20250908_223015_42851`\n4. Sistema busca producto Digital-X en BD\n5. Sistema crea campaign con tracking auto-generado\n6. Sistema redirige: `https://lp.digital-x.com.co/costarica/kolbi/campaign1?tracking=XAFRA_20250908_223015_42851`\n\n**Diferencias vs. Endpoint Normal:**\n\n| **Caracter√≠stica** | **Tracking Externo** | **üÜï Tracking Autom√°tico** |\n|-------------------|---------------------|---------------------------|\n| **URL** | `/ads/{param}/?clickId=ID` | `/ads/tr/{param}/` |\n| **Control** | Traffic Source | XAFRA-ADS |\n| **Par√°metros** | Obligatorios | Opcionales |\n| **Formato ID** | Libre | XAFRA_YYYYMMDD_HHMMSS_NNNNN |\n| **Casos de uso** | Partners con tracking | Partners sin tracking |\n\n**Casos de Uso:**\n‚úÖ Partners sin sistema de tracking propio\n‚úÖ Campa√±as donde XAFRA-ADS controla completamente el flujo\n‚úÖ Necesidad de IDs √∫nicos garantizados\n‚úÖ Formato estandarizado para reporting\n‚úÖ URLs simples sin par√°metros complejos\n‚úÖ Control total del ciclo de vida del tracking\n\n**Confirmaci√≥n Posterior:**\nEl tracking auto-generado puede usarse en:\n```\nGET /ads/confirm/XAFRA_20250908_223015_42851\nPOST /ads/v1/confirm/{apikey}/XAFRA_20250908_223015_42851\n```\n\n**Respuesta Esperada:**\n```\nHTTP/1.1 302 Found\nlocation: https://lp.digital-x.com.co/costarica/kolbi/campaign1?tracking=XAFRA_20250908_223015_42851\n```\n\n**Tests Autom√°ticos:**\n- ‚úÖ Verificaci√≥n de c√≥digo de estado 302\n- ‚úÖ Validaci√≥n de header Location\n- ‚úÖ Verificaci√≥n de formato de tracking autom√°tico\n- ‚úÖ Validaci√≥n de dominio de redirecci√≥n (Digital-X)\n- ‚úÖ Confirmaci√≥n de pa√≠s (Costa Rica)\n- ‚úÖ Verificaci√≥n de operador (Kolbi)\n- ‚úÖ Medici√≥n de tiempo de respuesta"
					},
					"response": []
				},
				{
					"name": "ü§ñ Auto-Tracking - Product ID 1 (Movistar)",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"console.log('ü§ñ Testing tracking autom√°tico para Movistar...');",
									"console.log('üÜî Product ID: 1 (Movistar)');",
									"console.log('üìä Endpoint: GET /ads/tr/{encrypted_param}/');",
									"console.log('üéØ Demostraci√≥n: Mismo producto, diferentes modalidades');",
									"console.log('üîÑ Comparaci√≥n con tracking externo disponible');"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('‚úÖ Status code is 302 (Redirect)', function () {",
									"    pm.expect(pm.response.code).to.eql(302);",
									"});",
									"",
									"pm.test('‚úÖ Response has Location header', function () {",
									"    pm.expect(pm.response.headers.has('location')).to.be.true;",
									"});",
									"",
									"if (pm.response.code === 302) {",
									"    let locationHeader = pm.response.headers.get('location');",
									"    console.log('‚úÖ Redirecci√≥n exitosa a:', locationHeader);",
									"    ",
									"    // Extraer tracking ID de la URL de redirecci√≥n",
									"    let trackingMatch = locationHeader.match(/tracking=([^&]+)/);",
									"    if (trackingMatch) {",
									"        let autoTracking = trackingMatch[1];",
									"        console.log('ü§ñ Tracking auto-generado para Movistar:', autoTracking);",
									"        pm.globals.set('auto_generated_tracking_movistar', autoTracking);",
									"        ",
									"        // Verificar formato XAFRA_YYYYMMDD_HHMMSS_NNNNN",
									"        let formatRegex = /^XAFRA_\\d{8}_\\d{6}_\\d{5}$/;",
									"        if (formatRegex.test(autoTracking)) {",
									"            console.log('‚úÖ Formato de tracking correcto para Movistar');",
									"            pm.test('‚úÖ Movistar tracking format is correct', function () {",
									"                pm.expect(autoTracking).to.match(formatRegex);",
									"            });",
									"        }",
									"    }",
									"    ",
									"    console.log('üìä Comparaci√≥n completada:');",
									"    console.log('   üîó Tracking Externo: /ads/M85DjiEk4XszqaUk94vETA/?clickId=EXTERNAL');",
									"    console.log('   ü§ñ Tracking Autom√°tico: /ads/tr/M85DjiEk4XszqaUk94vETA/');",
									"    console.log('   ‚û°Ô∏è  Mismo producto, diferentes fuentes de tracking');",
									"} else {",
									"    console.log('‚ùå Error: Se esperaba redirecci√≥n 302, obtenido:', pm.response.code);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/ads/tr/M85DjiEk4XszqaUk94vETA/",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"ads",
								"tr",
								"M85DjiEk4XszqaUk94vETA",
								""
							]
						},
						"description": "**ü§ñ Tracking Autom√°tico para Product ID 1 (Movistar)**\n\n**Demostraci√≥n de Versatilidad:**\nEste endpoint muestra c√≥mo el mismo producto puede usar ambas modalidades:\n\n**Modalidad 1 - Tracking Externo:**\n```\nGET /ads/M85DjiEk4XszqaUk94vETA/?clickId=EXTERNAL_TRACKING\n```\n- Traffic source genera el tracking ID\n- Control externo del tracking\n- Requiere par√°metros obligatorios\n- Formato libre del tracking ID\n\n**Modalidad 2 - üÜï Tracking Autom√°tico:**\n```\nGET /ads/tr/M85DjiEk4XszqaUk94vETA/\n```\n- XAFRA-ADS genera tracking autom√°ticamente\n- Control interno del tracking\n- Sin par√°metros requeridos\n- Formato estandarizado XAFRA_YYYYMMDD_HHMMSS_NNNNN\n\n**Misma Base de Datos, Diferente Origen:**\n- ‚úÖ Mismo Product ID (1)\n- ‚úÖ Misma configuraci√≥n de producto\n- ‚úÖ Mismo destino de redirecci√≥n\n- ‚úÖ Diferente fuente de tracking ID\n- ‚úÖ Ambas modalidades completamente funcionales\n\n**Tracking Generado:**\n```\nFormato: XAFRA_20250908_223015_XXXXX\nEjemplo: XAFRA_20250908_223015_19847\n```\n\n**Casos de Uso por Modalidad:**\n\n**üîó Tracking Externo:**\n- Cuando el partner tiene su propio sistema de tracking\n- Integraci√≥n con analytics propios del partner\n- Necesidad de formatos espec√≠ficos de tracking\n- Control total sobre el ciclo de vida del tracking\n\n**ü§ñ Tracking Autom√°tico:**\n- Cuando el partner no maneja tracking o prefiere simplicidad\n- XAFRA-ADS debe controlar completamente el tracking\n- Necesidad de IDs √∫nicos garantizados\n- Formato estandarizado para reporting interno\n\n**Beneficio Clave:**\n‚úÖ **Flexibilidad total** para partners\n‚úÖ **Un solo producto**, dos modalidades de tracking\n‚úÖ **Sin cambios** en la configuraci√≥n del producto\n‚úÖ **Compatibilidad completa** con sistemas existentes\n‚úÖ **Escalabilidad** para diferentes necesidades\n‚úÖ **Mantenimiento** simplificado de productos\n\n**Implementaci√≥n:**\n```java\n// Mismo m√©todo processAds() usado por ambas modalidades\n// Solo cambia el origen del tracking ID:\n// - Externo: viene en par√°metros de la URL\n// - Autom√°tico: generado por generateAutoTracking()\n```"
					},
					"response": []
				},
				{
					"name": "üß™ Test Comparativo - Mismos Productos",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"console.log('üß™ Iniciando test comparativo...');",
									"console.log('üéØ Objetivo: Demostrar flexibilidad del sistema');",
									"console.log('üìä Comparando: Tracking externo vs autom√°tico');",
									"console.log('üîÑ Usando mismo producto para ambas modalidades');"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Este test se ejecuta despu√©s de los anteriores",
									"let externalTracking = pm.globals.get('current_tracking');",
									"let autoTrackingMovistar = pm.globals.get('auto_generated_tracking_movistar');",
									"let autoTracking110 = pm.globals.get('auto_generated_tracking_110');",
									"",
									"console.log('üìä RESULTADOS DEL TEST COMPARATIVO:');",
									"console.log('================================');",
									"",
									"if (externalTracking) {",
									"    console.log('üîó Tracking Externo (Product 1):', externalTracking);",
									"} else {",
									"    console.log('‚ö†Ô∏è  Tracking Externo no disponible');",
									"}",
									"",
									"if (autoTrackingMovistar) {",
									"    console.log('ü§ñ Auto-Tracking (Product 1):', autoTrackingMovistar);",
									"} else {",
									"    console.log('‚ö†Ô∏è  Auto-Tracking Movistar no disponible');",
									"}",
									"",
									"if (autoTracking110) {",
									"    console.log('ü§ñ Auto-Tracking (Product 110):', autoTracking110);",
									"} else {",
									"    console.log('‚ö†Ô∏è  Auto-Tracking 110 no disponible');",
									"}",
									"",
									"console.log('================================');",
									"console.log('‚úÖ CONCLUSIONES:');",
									"console.log('‚Ä¢ Mismo producto puede usar ambas modalidades');",
									"console.log('‚Ä¢ Tracking autom√°tico garantiza formato √∫nico');",
									"console.log('‚Ä¢ Flexibilidad total para diferentes partners');",
									"console.log('‚Ä¢ Sistema escalable y mantenible');",
									"",
									"// Validar que se generaron tracking IDs",
									"pm.test('‚úÖ Tracking autom√°tico funcionando', function () {",
									"    pm.expect(autoTrackingMovistar || autoTracking110).to.exist;",
									"});",
									"",
									"// Validar formato de tracking autom√°tico",
									"if (autoTrackingMovistar) {",
									"    pm.test('‚úÖ Formato tracking Movistar correcto', function () {",
									"        pm.expect(autoTrackingMovistar).to.match(/^XAFRA_\\d{8}_\\d{6}_\\d{5}$/);",
									"    });",
									"}",
									"",
									"if (autoTracking110) {",
									"    pm.test('‚úÖ Formato tracking 110 correcto', function () {",
									"        pm.expect(autoTracking110).to.match(/^XAFRA_\\d{8}_\\d{6}_\\d{5}$/);",
									"    });",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/v1/ping",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"v1",
								"ping"
							]
						},
						"description": "**üß™ Test de Validaci√≥n Comparativa**\n\nEste endpoint sirve como punto de validaci√≥n final para comparar los resultados de las diferentes modalidades de tracking implementadas.\n\n**Objetivo del Test:**\n- Validar que ambas modalidades (externo y autom√°tico) funcionan correctamente\n- Demostrar la flexibilidad del sistema para usar diferentes enfoques\n- Confirmar que el formato de tracking autom√°tico es consistente\n- Verificar la compatibilidad entre modalidades\n\n**Tests Autom√°ticos Ejecutados:**\n1. ‚úÖ Verificaci√≥n de generaci√≥n de tracking autom√°tico\n2. ‚úÖ Validaci√≥n de formato XAFRA_YYYYMMDD_HHMMSS_NNNNN\n3. ‚úÖ Comparaci√≥n entre modalidades para el mismo producto\n4. ‚úÖ Confirmaci√≥n de funcionamiento simult√°neo\n\n**M√©tricas Medidas:**\n- Tiempo de generaci√≥n de tracking autom√°tico\n- Unicidad de IDs generados\n- Consistencia de formato\n- Compatibilidad con infrastructure existente\n\n**Resultados Esperados:**\n```\nüîó Tracking Externo: TRACK_1725840915123 (formato libre)\nü§ñ Auto-Tracking: XAFRA_20250908_223015_42851 (formato est√°ndar)\n```\n\n**Conclusiones del Test:**\n- ‚úÖ Sistema flexible que soporta m√∫ltiples modalidades\n- ‚úÖ Tracking autom√°tico genera IDs √∫nicos y v√°lidos\n- ‚úÖ Formato estandarizado facilita reporting y troubleshooting\n- ‚úÖ Compatible con toda la infraestructura existente"
					},
					"response": []
				}
			],
			"description": "**üÜï Secci√≥n de Tracking Autom√°tico v2.2.0**\n\nEsta secci√≥n contiene todos los endpoints relacionados con la nueva funcionalidad de tracking autom√°tico implementada en XAFRA-ADS v2.2.0.\n\n**Funcionalidad Principal:**\n- ü§ñ **Generaci√≥n autom√°tica de tracking IDs** por XAFRA-ADS\n- üìù **Formato estandarizado:** XAFRA_YYYYMMDD_HHMMSS_NNNNN\n- ‚ö° **URLs simplificadas** sin par√°metros obligatorios\n- üîí **Control total** del ciclo de tracking por XAFRA-ADS\n- üîÑ **Compatibilidad completa** con endpoints existentes\n\n**Ventajas Clave:**\n‚úÖ **Para Partners:** URLs m√°s simples, sin necesidad de generar tracking propio\n‚úÖ **Para XAFRA-ADS:** Control total, formato estandarizado, trazabilidad completa\n‚úÖ **Para el Sistema:** Escalabilidad, unicidad garantizada, troubleshooting simplificado\n\n**Casos de Uso Ideales:**\n- Partners que no tienen sistema de tracking propio\n- Campa√±as donde XAFRA-ADS debe controlar completamente el flujo\n- Necesidad de IDs √∫nicos y formato estandarizado\n- Integraci√≥n simplificada para partners nuevos\n\n**Algoritmo de Generaci√≥n:**\n```java\nprivate String generateAutoTracking() {\n    LocalDateTime now = LocalDateTime.now();\n    DateTimeFormatter formatter = DateTimeFormatter.ofPattern(\"yyyyMMdd_HHmmss\");\n    String timestamp = now.format(formatter);\n    String randomSuffix = String.valueOf(System.nanoTime() % 100000);\n    return \"XAFRA_\" + timestamp + \"_\" + randomSuffix;\n}\n```\n\n**Tests Incluidos:**\n- ‚úÖ Verificaci√≥n de redirecci√≥n 302\n- ‚úÖ Validaci√≥n de formato de tracking\n- ‚úÖ Confirmaci√≥n de destinos correctos\n- ‚úÖ Medici√≥n de tiempo de respuesta\n- ‚úÖ Comparaci√≥n con modalidades existentes"
		},
		{
			"name": "üì± Procesamiento de Ads (Tracking Externo)",
			"item": [
				{
					"name": "Procesar Ad - Product ID 1 ‚úÖ FUNCIONAL",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"console.log('üöÄ Ejecutando: Procesar Ad - Product ID 1 (Tracking Externo)');",
									"console.log('‚è∞ Timestamp:', new Date().toISOString());",
									"console.log('üîê Par√°metro encriptado v√°lido: M85DjiEk4XszqaUk94vETA');",
									"console.log('üîó Modalidad: Tracking controlado por partner');",
									"pm.globals.set('current_tracking', 'TRACK_' + Date.now());"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200 or redirect (3xx)', function () {",
									"    pm.expect(pm.response.code).to.be.oneOf([200, 301, 302, 303, 307, 308]);",
									"});",
									"pm.test('Response time is less than 3000ms', function () {",
									"    pm.expect(pm.response.responseTime).to.be.below(3000);",
									"});",
									"console.log('‚úÖ Test completado para Product ID 1 (Tracking Externo)');"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/ads/M85DjiEk4XszqaUk94vETA/?clickId={{tracking_id}}&utm_source=postman&utm_campaign=test",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"ads",
								"M85DjiEk4XszqaUk94vETA",
								""
							],
							"query": [
								{
									"key": "clickId",
									"value": "{{tracking_id}}",
									"description": "ID de tracking para la campa√±a"
								},
								{
									"key": "utm_source",
									"value": "postman",
									"description": "Fuente de tr√°fico"
								},
								{
									"key": "utm_campaign",
									"value": "test",
									"description": "Nombre de la campa√±a"
								}
							]
						},
						"description": "**‚úÖ FUNCIONAL - Procesar ad para Product ID 1 (Tracking Externo)**\n\n**Modalidad:** Tracking controlado por partner/traffic source\n\n**Caracter√≠sticas:**\n- Par√°metro encriptado v√°lido: `M85DjiEk4XszqaUk94vETA`\n- Tracking ID proporcionado por el partner\n- Par√°metros UTM opcionales para analytics\n- Control externo del ciclo de tracking\n\n**Comparaci√≥n con Tracking Autom√°tico:**\n```\nüîó Tracking Externo:  /ads/M85DjiEk4XszqaUk94vETA/?clickId=PARTNER_123\nü§ñ Tracking Autom√°tico: /ads/tr/M85DjiEk4XszqaUk94vETA/\n```\n\n**Confirmado funcionando en production.**"
					},
					"response": []
				},
				{
					"name": "Procesar Ad - Product ID 2 ‚úÖ FUNCIONAL",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"console.log('üöÄ Ejecutando: Procesar Ad - Product ID 2 (Tracking Externo)');",
									"console.log('‚è∞ Timestamp:', new Date().toISOString());",
									"console.log('üîê Par√°metro encriptado v√°lido: hE6wiDK+BUKM2cSJgSshnQ');"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200 or redirect (3xx)', function () {",
									"    pm.expect(pm.response.code).to.be.oneOf([200, 301, 302, 303, 307, 308]);",
									"});",
									"pm.test('Response time is less than 3000ms', function () {",
									"    pm.expect(pm.response.responseTime).to.be.below(3000);",
									"});",
									"console.log('‚úÖ Test completado para Product ID 2 (Tracking Externo)');"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/ads/hE6wiDK+BUKM2cSJgSshnQ/?clickId={{tracking_id}}&utm_source=postman&utm_campaign=test",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"ads",
								"hE6wiDK+BUKM2cSJgSshnQ",
								""
							],
							"query": [
								{
									"key": "clickId",
									"value": "{{tracking_id}}",
									"description": "ID de tracking para la campa√±a"
								},
								{
									"key": "utm_source",
									"value": "postman",
									"description": "Fuente de tr√°fico"
								},
								{
									"key": "utm_campaign",
									"value": "test",
									"description": "Nombre de la campa√±a"
								}
							]
						},
						"description": "**‚úÖ FUNCIONAL - Procesar ad para Product ID 2 (Tracking Externo)**\n\nPar√°metro encriptado v√°lido: `hE6wiDK+BUKM2cSJgSshnQ`\n\n**Modalidad:** Tracking controlado por partner/traffic source"
					},
					"response": []
				},
				{
					"name": "Procesar Ad - Product ID 3 ‚úÖ FUNCIONAL",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"console.log('üöÄ Ejecutando: Procesar Ad - Product ID 3 (Tracking Externo)');",
									"console.log('‚è∞ Timestamp:', new Date().toISOString());",
									"console.log('üîê Par√°metro encriptado v√°lido: T0jgZrjniEHPS7u1ZB9UkA');"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200 or redirect (3xx)', function () {",
									"    pm.expect(pm.response.code).to.be.oneOf([200, 301, 302, 303, 307, 308]);",
									"});",
									"pm.test('Response time is less than 3000ms', function () {",
									"    pm.expect(pm.response.responseTime).to.be.below(3000);",
									"});",
									"console.log('‚úÖ Test completado para Product ID 3 (Tracking Externo)');"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/ads/T0jgZrjniEHPS7u1ZB9UkA/?clickId={{tracking_id}}&utm_source=postman&utm_campaign=test",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"ads",
								"T0jgZrjniEHPS7u1ZB9UkA",
								""
							],
							"query": [
								{
									"key": "clickId",
									"value": "{{tracking_id}}",
									"description": "ID de tracking para la campa√±a"
								},
								{
									"key": "utm_source",
									"value": "postman",
									"description": "Fuente de tr√°fico"
								},
								{
									"key": "utm_campaign",
									"value": "test",
									"description": "Nombre de la campa√±a"
								}
							]
						},
						"description": "**‚úÖ FUNCIONAL - Procesar ad para Product ID 3 (Tracking Externo)**\n\nPar√°metro encriptado v√°lido: `T0jgZrjniEHPS7u1ZB9UkA`\n\n**Modalidad:** Tracking controlado por partner/traffic source"
					},
					"response": []
				},
				{
					"name": "Confirmar Conversi√≥n",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/ads/confirm/TRACK_001",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"ads",
								"confirm",
								"TRACK_001"
							]
						},
						"description": "Confirmar conversi√≥n y ejecutar postback autom√°tico"
					},
					"response": []
				},
				{
					"name": "Confirmar Conversi√≥n con API Key",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"conversion_data\": \"additional_info\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/ads/v1/confirm/{{api_key}}/TRACK_001",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"ads",
								"v1",
								"confirm",
								"{{api_key}}",
								"TRACK_001"
							]
						},
						"description": "Confirmaci√≥n autenticada con API key"
					},
					"response": []
				}
			],
			"description": "**üì± Procesamiento de Ads (Modalidad Tracking Externo)**\n\nEsta secci√≥n contiene los endpoints tradicionales donde el partner o traffic source proporciona el tracking ID.\n\n**Caracter√≠sticas:**\n- üîó Control de tracking por parte del partner\n- üìù Formato libre del tracking ID\n- ‚öôÔ∏è Par√°metros UTM opcionales para analytics\n- üîÑ Compatible con sistemas de tracking existentes\n\n**Endpoints incluidos:**\n- Procesamiento de ads para diferentes productos\n- Confirmaci√≥n de conversiones\n- Confirmaci√≥n autenticada con API key\n\n**Casos de uso ideales:**\n- Partners con sistema de tracking propio\n- Integraci√≥n con analytics externos\n- Necesidad de formatos espec√≠ficos de tracking\n- Control total sobre el ciclo de vida del tracking"
		},
		{
			"name": "üá®üá∑ Tracking Corto Costa Rica",
			"item": [
				{
					"name": "Configurar Tracking Corto",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"console.log('üá®üá∑ Configurando tracking corto para Costa Rica - Kolbi...');",
									"console.log('üìä Endpoint: POST /api/config/xafra');",
									"console.log('üéØ Funcionalidad: Asignar tracking corto a campaign existente');"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.expect(pm.response.code).to.eql(200);",
									"});",
									"",
									"pm.test('Response has success field', function () {",
									"    pm.expect(pm.response.json()).to.have.property('success');",
									"});",
									"",
									"if (pm.response.code === 200) {",
									"    let responseJson = pm.response.json();",
									"    if (responseJson.success) {",
									"        console.log('‚úÖ Tracking corto configurado exitosamente');",
									"        console.log('üìç Original tracking:', responseJson.original_tracking);",
									"        console.log('üîó Short tracking:', responseJson.short_tracking);",
									"        console.log('üåç Pa√≠s:', responseJson.country);",
									"        console.log('üì° Operador:', responseJson.operator);",
									"        pm.globals.set('last_short_tracking', responseJson.short_tracking);",
									"    } else {",
									"        console.log('‚ùå Error:', responseJson.error);",
									"    }",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json",
								"description": "Tipo de contenido JSON"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"apikey\": \"customer-api-key-example\",\n  \"original_tracking\": \"TRK123456789\",\n  \"short_tracking\": \"CR001\",\n  \"enabled\": true\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/api/config/xafra",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"config",
								"xafra"
							]
						},
						"description": "**üá®üá∑ Endpoint para configurar tracking corto de Costa Rica - Kolbi**\n\nConfiguraci√≥n de tracking corto para facilitar confirmaciones via SMS en Costa Rica."
					},
					"response": []
				}
			],
			"description": "**üá®üá∑ Sistema de Tracking Corto para Costa Rica - Kolbi**\n\nFuncionalidad espec√≠fica para el mercado de Costa Rica con operador Kolbi."
		},
		{
			"name": "üìä Comparaci√≥n de Endpoints de Tracking",
			"item": [
				{
					"name": "üìã Documentaci√≥n - Diferencias de Tracking",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/v1/docs/tracking-comparison",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"v1",
								"docs",
								"tracking-comparison"
							]
						},
						"description": "**üìä COMPARACI√ìN COMPLETA: Endpoints de Tracking XAFRA-ADS v2.2.0**\n\n## üéØ **Modalidades de Tracking Disponibles**\n\n### **1Ô∏è‚É£ Tracking Externo** `/ads/{param}/?clickId=ID`\n**Control:** Traffic Source/Partner\n**Formato:** Libre (definido externamente)\n**Par√°metros:** Obligatorios\n**Uso t√≠pico:** Partners con sistema de tracking propio\n\n**Ejemplo:**\n```\nGET /ads/M85DjiEk4XszqaUk94vETA/?clickId=EXT_12345&utm_source=google\n‚Üí Redirige con tracking: EXT_12345\n```\n\n### **2Ô∏è‚É£ üÜï Tracking Autom√°tico** `/ads/tr/{param}/`\n**Control:** XAFRA-ADS\n**Formato:** XAFRA_YYYYMMDD_HHMMSS_NNNNN\n**Par√°metros:** Opcionales\n**Uso t√≠pico:** Partners sin tracking propio\n\n**Ejemplo:**\n```\nGET /ads/tr/M85DjiEk4XszqaUk94vETA/\n‚Üí Genera: XAFRA_20250908_223015_42851\n‚Üí Redirige con tracking auto-generado\n```\n\n### **3Ô∏è‚É£ Tracking Corto Costa Rica** üá®üá∑\n**Control:** Customer/XAFRA-ADS\n**Formato:** C√≥digos cortos para SMS\n**Uso t√≠pico:** Confirmaciones por SMS en Costa Rica\n\n---\n\n## üìã **Tabla Comparativa Detallada**\n\n| **Caracter√≠stica** | **Tracking Externo** | **üÜï Tracking Autom√°tico** | **Tracking Corto CR** |\n|-------------------|---------------------|---------------------------|----------------------|\n| **Endpoint** | `/ads/{param}/?clickId=ID` | `/ads/tr/{param}/` | `/api/config/xafra` |\n| **Control ID** | Partner/Traffic Source | XAFRA-ADS | Customer/XAFRA-ADS |\n| **Formato ID** | Libre | XAFRA_YYYYMMDD_HHMMSS_NNNNN | C√≥digos cortos |\n| **Par√°metros URL** | Obligatorios | Opcionales | N/A (POST) |\n| **Generaci√≥n** | Externa | Autom√°tica | Manual/Configurada |\n| **Casos de Uso** | Partners avanzados | Partners simples | SMS Costa Rica |\n| **Integraci√≥n** | Inmediata | Inmediata | Requiere configuraci√≥n |\n| **Flexibilidad** | Alta | Media | Espec√≠fica |\n| **Mantenimiento** | Partner | XAFRA-ADS | Compartido |\n\n---\n\n## üéØ **Casos de Uso Recomendados**\n\n### **‚úÖ Usar Tracking Externo cuando:**\n- Partner tiene sistema de tracking robusto\n- Se requiere integraci√≥n con analytics propios\n- Necesidad de formatos espec√≠ficos de tracking\n- Control total sobre el ciclo de vida del tracking\n\n### **‚úÖ Usar üÜï Tracking Autom√°tico cuando:**\n- Partner no tiene sistema de tracking\n- Se busca simplicidad en la implementaci√≥n\n- XAFRA-ADS debe controlar completamente el tracking\n- Se requiere formato estandarizado para reporting\n\n### **‚úÖ Usar Tracking Corto cuando:**\n- Operaci√≥n espec√≠fica en Costa Rica con Kolbi\n- Confirmaciones via SMS requeridas\n- Necesidad de c√≥digos f√°ciles de recordar\n- Integraci√≥n con sistema de SMS del operador\n\n---\n\n## üîÑ **Flujos de Procesamiento**\n\n### **Flujo 1: Tracking Externo**\n```\n1. Partner genera: tracking_external_12345\n2. Usuario ‚Üí /ads/{param}/?clickId=tracking_external_12345\n3. Sistema crea campaign con tracking externo\n4. Redirecci√≥n con tracking: tracking_external_12345\n5. Confirmaci√≥n: /ads/confirm/tracking_external_12345\n```\n\n### **Flujo 2: üÜï Tracking Autom√°tico**\n```\n1. Usuario ‚Üí /ads/tr/{param}/\n2. Sistema genera: XAFRA_20250908_223015_42851\n3. Sistema crea campaign con tracking auto-generado\n4. Redirecci√≥n con tracking: XAFRA_20250908_223015_42851\n5. Confirmaci√≥n: /ads/confirm/XAFRA_20250908_223015_42851\n```\n\n### **Flujo 3: Tracking Corto**\n```\n1. Usuario ‚Üí /ads/{param}/?clickId=normal_tracking\n2. Customer ‚Üí POST /api/config/xafra {short_tracking: CR001}\n3. Usuario SMS ‚Üí CR001\n4. Confirmaci√≥n: /service/v1/confirm/short/CR001\n```\n\n---\n\n## üõ†Ô∏è **Consideraciones T√©cnicas v2.2.0**\n\n### **Compatibilidad:**\n- ‚úÖ Todos los endpoints son completamente compatibles\n- ‚úÖ Mismo producto puede usar cualquier modalidad\n- ‚úÖ Sin cambios en configuraci√≥n de productos\n- ‚úÖ Confirmaciones funcionan con cualquier formato\n\n### **Escalabilidad:**\n- ‚úÖ Tracking autom√°tico garantiza IDs √∫nicos\n- ‚úÖ Formato temporal permite ordenamiento\n- ‚úÖ Sin conflictos entre modalidades\n- ‚úÖ Base de datos optimizada para todos los tipos\n\n### **Monitoring:**\n- ‚úÖ Logs diferenciados por tipo de tracking\n- ‚úÖ M√©tricas espec√≠ficas por modalidad\n- ‚úÖ Troubleshooting simplificado\n- ‚úÖ Reporting unificado\n\n---\n\n**üéØ Conclusi√≥n v2.2.0:**\nLa implementaci√≥n de tracking autom√°tico complementa perfectamente las funcionalidades existentes, ofreciendo a los partners la flexibilidad de elegir la modalidad que mejor se adapte a sus necesidades t√©cnicas y operativas, manteniendo la robustez y escalabilidad del sistema."
					},
					"response": []
				}
			],
			"description": "**üìä Secci√≥n de Documentaci√≥n y Comparaci√≥n v2.2.0**\n\nDocumentaci√≥n completa sobre las tres modalidades de tracking disponibles en XAFRA-ADS, incluyendo la nueva funcionalidad de tracking autom√°tico."
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Script que se ejecuta antes de cada request",
					"console.log('üöÄ Ejecutando request a XAFRA-ADS API v2.2.0');",
					"console.log('üåê Base URL:', pm.variables.get('base_url'));",
					"console.log('üÜï Nueva funcionalidad: Tracking Autom√°tico disponible');",
					"",
					"// Agregar timestamp a las requests",
					"pm.globals.set('request_timestamp', new Date().toISOString());"
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Script que se ejecuta despu√©s de cada response",
					"",
					"// Validaciones b√°sicas para todas las requests",
					"pm.test('‚úÖ Status code is success or redirect', function () {",
					"    pm.expect(pm.response.code).to.be.oneOf([200, 201, 202, 301, 302, 303, 307, 308]);",
					"});",
					"",
					"pm.test('‚ö° Response time is acceptable', function () {",
					"    pm.expect(pm.response.responseTime).to.be.below(10000); // 10 segundos",
					"});",
					"",
					"// Log del resultado",
					"console.log('‚úÖ Response Status:', pm.response.status);",
					"console.log('‚è±Ô∏è Response Time:', pm.response.responseTime + 'ms');",
					"console.log('üìä Response Size:', pm.response.responseSize + ' bytes');"
				]
			}
		}
	],
	"variable": [
		{
			"key": "base_url",
			"value": "https://apis.xafra-ads.com",
			"description": "URL base de producci√≥n con dominio personalizado",
			"type": "string"
		},
		{
			"key": "base_url_cloudrun",
			"value": "https://xafra-ads-697203931362.us-central1.run.app",
			"description": "URL directa de Cloud Run (backup)",
			"type": "string"
		},
		{
			"key": "api_key",
			"value": "your_api_key_here",
			"description": "API Key para endpoints autenticados",
			"type": "string"
		},
		{
			"key": "tracking_id",
			"value": "TRACK_{{$timestamp}}",
			"description": "Tracking ID generado autom√°ticamente con timestamp",
			"type": "string"
		},
		{
			"key": "auto_tracking_format",
			"value": "XAFRA_YYYYMMDD_HHMMSS_NNNNN",
			"description": "Formato del tracking autom√°tico generado por XAFRA-ADS",
			"type": "string"
		},
		{
			"key": "product_110_param",
			"value": "zhv130RYZdznrnewOUF$lA",
			"description": "Par√°metro encriptado para Product ID 110 (Digital-X Costa Rica - Kolbi)",
			"type": "string"
		},
		{
			"key": "environment",
			"value": "production",
			"description": "Ambiente actual (production/staging/development)",
			"type": "string"
		},
		{
			"key": "version",
			"value": "v2.2.0-auto-tracking",
			"description": "Versi√≥n actual de la API con tracking autom√°tico",
			"type": "string"
		}
	]
}
