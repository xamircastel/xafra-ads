# üöÄ Gu√≠a de Uso: XAFRA-ADS Postman Collection v2.2.0

## üìã **Introducci√≥n**

Esta gu√≠a te ayudar√° a usar la nueva **Collection v2.2.0** de XAFRA-ADS que incluye la funcionalidad de **tracking autom√°tico**. La collection est√° optimizada para testing, validaci√≥n y documentaci√≥n de todas las modalidades de tracking disponibles.

---

## üì• **Instalaci√≥n y Configuraci√≥n**

### **1. Importar la Collection**
```bash
Archivo: XAFRA-ADS-APIs-Collection-v2.2.0.postman_collection.json
```

**Pasos:**
1. Abrir **Postman**
2. Click en **Import**
3. Seleccionar el archivo `XAFRA-ADS-APIs-Collection-v2.2.0.postman_collection.json`
4. Confirmar importaci√≥n

### **2. Configurar Variables**
La collection incluye variables pre-configuradas:

```json
{
  "base_url": "https://apis.xafra-ads.com",
  "base_url_cloudrun": "https://xafra-ads-697203931362.us-central1.run.app",
  "api_key": "your_api_key_here",
  "tracking_id": "TRACK_{{$timestamp}}",
  "auto_tracking_format": "XAFRA_YYYYMMDD_HHMMSS_NNNNN",
  "product_110_param": "zhv130RYZdznrnewOUF$lA",
  "environment": "production",
  "version": "v2.2.0-auto-tracking"
}
```

**üîß Configuraci√≥n requerida:**
- Actualizar `api_key` con tu API key real (si usas endpoints autenticados)
- Verificar que `base_url` apunte al ambiente correcto

---

## üß™ **Gu√≠a de Testing**

### **üÜï Secci√≥n 1: Tracking Autom√°tico (v2.2.0)**

#### **Test 1: Auto-Tracking Product ID 110 (Digital-X CR)**
```
GET {{base_url}}/ads/tr/{{product_110_param}}/
```

**‚úÖ Validaciones autom√°ticas:**
- Status code 302 (redirecci√≥n)
- Header Location presente
- Formato tracking: `XAFRA_YYYYMMDD_HHMMSS_NNNNN`
- Redirecci√≥n a Digital-X Costa Rica
- Operador Kolbi confirmado

**üìä Resultados esperados:**
```
ü§ñ Tracking auto-generado: XAFRA_20250908_223015_42851
‚úÖ Redirecci√≥n exitosa a: https://lp.digital-x.com.co/costarica/kolbi/campaign1?tracking=XAFRA_20250908_223015_42851
```

#### **Test 2: Auto-Tracking Product ID 1 (Movistar)**
```
GET {{base_url}}/ads/tr/M85DjiEk4XszqaUk94vETA/
```

**üéØ Prop√≥sito:** Demostrar versatilidad del mismo producto

**üìã Comparaci√≥n autom√°tica:**
- Tracking Externo: `/ads/M85DjiEk4XszqaUk94vETA/?clickId=EXTERNAL`
- Tracking Autom√°tico: `/ads/tr/M85DjiEk4XszqaUk94vETA/`

#### **Test 3: Validaci√≥n Comparativa**
**üß™ Endpoint de validaci√≥n:** `GET {{base_url}}/v1/ping`

**üìä Tests ejecutados:**
- Verificaci√≥n de generaci√≥n de tracking autom√°tico
- Validaci√≥n de formato para ambos productos
- Comparaci√≥n de modalidades
- Confirmaci√≥n de funcionamiento simult√°neo

### **üì± Secci√≥n 2: Tracking Externo (Tradicional)**

#### **Tests de Compatibilidad:**
Ejecuta estos tests para confirmar que la funcionalidad existente sigue funcionando:

1. **Product ID 1:** `GET {{base_url}}/ads/M85DjiEk4XszqaUk94vETA/?clickId={{tracking_id}}`
2. **Product ID 2:** `GET {{base_url}}/ads/hE6wiDK+BUKM2cSJgSshnQ/?clickId={{tracking_id}}`
3. **Product ID 3:** `GET {{base_url}}/ads/T0jgZrjniEHPS7u1ZB9UkA/?clickId={{tracking_id}}`

### **üìä Secci√≥n 3: Documentaci√≥n y Comparaci√≥n**

#### **Endpoint de Documentaci√≥n:**
```
GET {{base_url}}/v1/docs/tracking-comparison
```

**üìö Contenido incluido:**
- Tabla comparativa de modalidades
- Casos de uso recomendados
- Flujos de procesamiento
- Consideraciones t√©cnicas

---

## üéØ **Casos de Uso Recomendados**

### **ü§ñ Usar Tracking Autom√°tico cuando:**
```
‚úÖ Partner no tiene sistema de tracking propio
‚úÖ Se busca simplicidad en la implementaci√≥n
‚úÖ XAFRA-ADS debe controlar completamente el tracking
‚úÖ Se requiere formato estandarizado para reporting
‚úÖ URLs simples sin par√°metros complejos
```

**Ejemplo de implementaci√≥n:**
```javascript
// Simplemente acceder a la URL sin par√°metros
fetch('https://apis.xafra-ads.com/ads/tr/zhv130RYZdznrnewOUF$lA/')
  .then(response => {
    // Sistema redirige autom√°ticamente con tracking generado
    console.log('Tracking generado autom√°ticamente por XAFRA-ADS');
  });
```

### **üîó Usar Tracking Externo cuando:**
```
‚úÖ Partner tiene sistema de tracking robusto
‚úÖ Se requiere integraci√≥n con analytics propios
‚úÖ Necesidad de formatos espec√≠ficos de tracking
‚úÖ Control total sobre el ciclo de vida del tracking
```

**Ejemplo de implementaci√≥n:**
```javascript
// Generar tracking propio y enviarlo como par√°metro
const myTracking = 'PARTNER_' + Date.now();
fetch(`https://apis.xafra-ads.com/ads/M85DjiEk4XszqaUk94vETA/?clickId=${myTracking}`)
  .then(response => {
    // Sistema usa el tracking proporcionado
    console.log('Tracking controlado por partner:', myTracking);
  });
```

---

## üìä **Interpretaci√≥n de Resultados**

### **Tracking Autom√°tico Exitoso:**
```json
Status: 302 Found
Location: https://lp.digital-x.com.co/costarica/kolbi/campaign1?tracking=XAFRA_20250908_223015_42851

Formato tracking: XAFRA_YYYYMMDD_HHMMSS_NNNNN
‚úÖ XAFRA: Prefijo identificador
‚úÖ 20250908: Fecha (8 de septiembre de 2025)
‚úÖ 223015: Hora (22:30:15)
‚úÖ 42851: Secuencia √∫nica
```

### **Variables Globales Generadas:**
```javascript
pm.globals.get('auto_generated_tracking_110')    // Para Product 110
pm.globals.get('auto_generated_tracking_movistar') // Para Product 1
pm.globals.get('current_tracking')                 // Para tracking externo
```

---

## üîß **Troubleshooting**

### **‚ùå Error 404 en Tracking Autom√°tico**
**Problema:** `GET /ads/tr/{param}/` retorna 404

**Soluciones:**
1. **Verificar deployment:** Confirmar que el nuevo c√≥digo est√° desplegado
2. **Verificar URL:** Usar exactamente `/ads/tr/{param}/` (con `/tr/`)
3. **Testing local:** Probar primero en ambiente de desarrollo
4. **Logs del servidor:** Revisar logs de Cloud Run para errores de compilaci√≥n

### **‚ùå Formato de Tracking Incorrecto**
**Problema:** Tracking generado no sigue formato `XAFRA_YYYYMMDD_HHMMSS_NNNNN`

**Verificaciones:**
```javascript
// Test incluido en la collection
let formatRegex = /^XAFRA_\d{8}_\d{6}_\d{5}$/;
if (!formatRegex.test(tracking)) {
  console.log('‚ùå Formato incorrecto:', tracking);
}
```

### **‚ùå Redirecci√≥n a Destino Incorrecto**
**Problema:** No redirige al partner correcto

**Validaciones:**
1. **Par√°metro encriptado:** Verificar que el par√°metro corresponde al producto correcto
2. **Configuraci√≥n BD:** Confirmar que Product ID est√° configurado correctamente
3. **URL destino:** Verificar que la URL del partner es correcta

---

## üìà **M√©tricas y Monitoring**

### **Tests Autom√°ticos Incluidos:**
La collection ejecuta autom√°ticamente estos tests:

```javascript
‚úÖ Status code is 302 (Redirect)
‚úÖ Response has Location header  
‚úÖ Response time is acceptable
‚úÖ Tracking format is correct
‚úÖ Redirects to correct domain
‚úÖ Country is correct
‚úÖ Operator is correct
```

### **M√©tricas Medidas:**
- **Tiempo de respuesta:** Debe ser < 3000ms
- **Unicidad:** Cada tracking debe ser √∫nico
- **Formato:** Debe seguir XAFRA_YYYYMMDD_HHMMSS_NNNNN
- **Redirecci√≥n:** Debe apuntar al partner correcto

---

## üéØ **Flujo de Testing Recomendado**

### **1. Testing Inicial:**
```
1. Ejecutar Health Checks ‚Üí Verificar que la API est√° funcionando
2. Probar Tracking Externo ‚Üí Confirmar compatibilidad backward
3. Probar Tracking Autom√°tico ‚Üí Validar nueva funcionalidad
4. Ejecutar Tests Comparativos ‚Üí Verificar coexistencia
```

### **2. Testing de Integraci√≥n:**
```
1. Generar tracking autom√°tico ‚Üí Obtener tracking ID
2. Usar tracking para confirmaci√≥n ‚Üí POST /ads/confirm/{tracking}
3. Verificar en BD ‚Üí Confirmar que campaign se cre√≥ correctamente
4. Validar postbacks ‚Üí Verificar notificaciones a traffic sources
```

### **3. Testing de Performance:**
```
1. Ejecutar m√∫ltiples requests ‚Üí Verificar concurrencia
2. Medir tiempos de respuesta ‚Üí Confirmar performance
3. Validar unicidad ‚Üí Asegurar que no hay duplicados
4. Monitorear recursos ‚Üí Verificar uso de CPU/memoria
```

---

## üìö **Referencias y Documentaci√≥n**

### **Archivos Relacionados:**
- `AUTO-TRACKING-IMPLEMENTATION.md` - Documentaci√≥n t√©cnica completa
- `POSTMAN-COLLECTION-CHANGELOG-v2.2.0.md` - Changelog detallado
- `TRACKING-AUTOMATION-SUMMARY.md` - Resumen del proyecto

### **Endpoints de Documentaci√≥n:**
- `GET /v1/docs/tracking-comparison` - Comparaci√≥n de modalidades
- `GET /actuator/health` - Estado de la aplicaci√≥n
- `GET /v1/ping` - Health check simple

### **Variables de Environment:**
```
{{base_url}} - URL base de la API
{{product_110_param}} - Par√°metro para Digital-X Costa Rica
{{tracking_id}} - Tracking ID generado autom√°ticamente
{{auto_tracking_format}} - Formato de tracking autom√°tico
```

---

## üöÄ **Siguiente Nivel**

### **Automatizaci√≥n Avanzada:**
```javascript
// Script para testing autom√°tico de m√∫ltiples productos
const productos = [
  'M85DjiEk4XszqaUk94vETA',  // Product 1
  'hE6wiDK+BUKM2cSJgSshnQ',  // Product 2 
  'zhv130RYZdznrnewOUF$lA'   // Product 110
];

productos.forEach(param => {
  // Test tracking autom√°tico
  pm.sendRequest(`{{base_url}}/ads/tr/${param}/`, (err, res) => {
    console.log(`Auto-tracking para ${param}:`, res.headers.get('location'));
  });
});
```

### **Integraci√≥n con CI/CD:**
```bash
# Ejecutar collection desde Newman (CLI)
newman run XAFRA-ADS-APIs-Collection-v2.2.0.postman_collection.json \
  --environment production.postman_environment.json \
  --reporters cli,junit \
  --reporter-junit-export results.xml
```

---

## üéØ **Conclusi√≥n**

La **Collection v2.2.0** est√° dise√±ada para facilitar el testing y validaci√≥n de la nueva funcionalidad de **tracking autom√°tico** mientras mantiene compatibilidad completa con todas las funcionalidades existentes.

**Beneficios clave para el testing:**
- ‚úÖ **Tests autom√°ticos** completos y detallados
- ‚úÖ **Validaci√≥n de formato** en tiempo real
- ‚úÖ **Comparaci√≥n de modalidades** autom√°tica
- ‚úÖ **Documentaci√≥n integrada** en cada endpoint
- ‚úÖ **Troubleshooting** simplificado con logs detallados

**üöÄ ¬°Est√°s listo para probar la nueva funcionalidad de tracking autom√°tico!**

---

**üìÖ √öltima actualizaci√≥n:** Septiembre 8, 2025  
**üè∑Ô∏è Versi√≥n:** v2.2.0-auto-tracking  
**üë§ Autor:** XAFRA-ADS Development Team
